<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.dms.dao.DrugDefinedMainMapper">
  <resultMap id="BaseResultMap" type="com.project.dms.entiy.DrugDefinedMain">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="DRUG_SEQ_ID" jdbcType="INTEGER" property="drugSeqId" />
    <result column="SYMPTOMS_SEQ" jdbcType="INTEGER" property="symptomsSeq" />
    <result column="ORGANS_SEQ" jdbcType="INTEGER" property="organsSeq" />
    <result column="TONGUE_SEQ" jdbcType="INTEGER" property="tongueSeq" />
    <result column="SEASON_SEQ" jdbcType="INTEGER" property="seasonSeq" />
    <result column="YEAR_SEQ" jdbcType="INTEGER" property="yearSeq" />
    <result column="TIME_SEQ" jdbcType="INTEGER" property="timeSeq" />
    <result column="PHY_SEQ" jdbcType="INTEGER" property="phySeq" />
    <result column="CREATE_TIME" jdbcType="TIMESTAMP" property="createTime" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from drug_defined_main
    where DRUG_SEQ_ID = #{drugSeqId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" useGeneratedKeys="true" keyColumn="drugSeqId" keyProperty="drugSeqId"  parameterType="com.project.dms.entiy.DrugDefinedMain">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="drugSeqId" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into drug_defined_main (SYMPTOMS_SEQ, ORGANS_SEQ, TONGUE_SEQ, 
      SEASON_SEQ, YEAR_SEQ, TIME_SEQ, 
      PHY_SEQ, CREATE_TIME)
    values (#{symptomsSeq,jdbcType=INTEGER}, #{organsSeq,jdbcType=INTEGER}, #{tongueSeq,jdbcType=INTEGER}, 
      #{seasonSeq,jdbcType=INTEGER}, #{yearSeq,jdbcType=INTEGER}, #{timeSeq,jdbcType=INTEGER}, 
      #{phySeq,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.project.dms.entiy.DrugDefinedMain">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update drug_defined_main
    set SYMPTOMS_SEQ = #{symptomsSeq,jdbcType=INTEGER},
      ORGANS_SEQ = #{organsSeq,jdbcType=INTEGER},
      TONGUE_SEQ = #{tongueSeq,jdbcType=INTEGER},
      SEASON_SEQ = #{seasonSeq,jdbcType=INTEGER},
      YEAR_SEQ = #{yearSeq,jdbcType=INTEGER},
      TIME_SEQ = #{timeSeq,jdbcType=INTEGER},
      PHY_SEQ = #{phySeq,jdbcType=INTEGER},
      CREATE_TIME = #{createTime,jdbcType=TIMESTAMP}
    where DRUG_SEQ_ID = #{drugSeqId,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select DRUG_SEQ_ID, SYMPTOMS_SEQ, ORGANS_SEQ, TONGUE_SEQ, SEASON_SEQ, YEAR_SEQ, TIME_SEQ, 
    PHY_SEQ, CREATE_TIME
    from drug_defined_main
    where DRUG_SEQ_ID = #{drugSeqId,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select DRUG_SEQ_ID, SYMPTOMS_SEQ, ORGANS_SEQ, TONGUE_SEQ, SEASON_SEQ, YEAR_SEQ, TIME_SEQ, 
    PHY_SEQ, CREATE_TIME
    from drug_defined_main
  </select>
  
  <select id="selectByModel" parameterType="com.project.dms.entiy.DrugDefinedMain" resultMap="BaseResultMap">
   
    select from drug_defined_main 
    
    where SYMPTOMS_SEQ = #{symptomsSeq,jdbcType=INTEGER},
      ORGANS_SEQ = #{organsSeq,jdbcType=INTEGER},
      TONGUE_SEQ = #{tongueSeq,jdbcType=INTEGER},
      SEASON_SEQ = #{seasonSeq,jdbcType=INTEGER},
      YEAR_SEQ = #{yearSeq,jdbcType=INTEGER},
      TIME_SEQ = #{timeSeq,jdbcType=INTEGER},
      PHY_SEQ = #{phySeq,jdbcType=INTEGER}
  </select>
  
  <select id="selectYaofangByParts"  resultType="java.util.Map">
   
    select 
	g.DRUG_ID as DRUGID,
	g.DRUG_NAME as NAME,
	sum(f.UNIT_QTY) as COUNT,
	f.DRUG_TYPE as TYPE,
	g.UNIT_PRICE as PRICE
	
	 from DRUG_DEFINED_MAIN a 
	left join DRUG_DEFINED_SUB f on f.DRUG_SEQ_ID=a.DRUG_SEQ_ID 
	left join DRUG_LIST_DEF g on g.DRUG_ID=f.DRUG_ID 
	where 
	a.SYMPTOMS_SEQ=#{symptomsSeq}
	and a.ORGANS_SEQ=#{organsSeq}
	and a.TONGUE_SEQ=#{tongueSeq}
	and a.SEASON_SEQ=#{seasonSeq}
	and a.YEAR_SEQ=#{yearType}
	and a.TIME_SEQ=#{timeType}
	and a.PHY_SEQ in (${parts}) 
	group by g.DRUG_ID,g.DRUG_NAME,g.UNIT_PRICE,f.DRUG_TYPE 
	ORDER BY g.ORDERBY
	 
  </select>
  
    <select id="selectYaofangByParts2"  resultType="java.util.Map">
   
    select 
	g.DRUG_ID as DRUGID,
	g.DRUG_NAME as NAME,
	sum(f.UNIT_QTY) as COUNT,
	f.DRUG_TYPE as TYPE,
	g.UNIT_PRICE as PRICE,
	h.PHY_PART AS PART 
	 from DRUG_DEFINED_MAIN a 
	left join DRUG_DEFINED_SUB f on f.DRUG_SEQ_ID=a.DRUG_SEQ_ID 
	left join DRUG_LIST_DEF g on g.DRUG_ID=f.DRUG_ID 
	left join phy_part_type h on h.PHY_SEQ=a.PHY_SEQ
	where 
	a.SYMPTOMS_SEQ=#{symptomsSeq}
	and a.ORGANS_SEQ=#{organsSeq}
	and a.TONGUE_SEQ=#{tongueSeq}
	and a.SEASON_SEQ=#{seasonSeq}
	and a.YEAR_SEQ=#{yearType}
	and a.TIME_SEQ=#{timeType}
	and a.PHY_SEQ in (${parts}) 
	group by g.DRUG_ID,g.DRUG_NAME,g.UNIT_PRICE,f.DRUG_TYPE ,h.PHY_PART
	ORDER BY a.PHY_SEQ,g.ORDERBY
	 
  </select>
</mapper>