<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.dms.dao.PhyConditionTypeMapper">
  <resultMap id="BaseResultMap" type="com.project.dms.entiy.PhyConditionType">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="CONDITION_IDX" jdbcType="INTEGER" property="conditionIdx" />
    <result column="CONDITION_TYPE" jdbcType="VARCHAR" property="conditionType" />
    <result column="CONDITION_SUB_ID" jdbcType="INTEGER" property="conditionSubId" />
    <result column="CONDITION_ID" jdbcType="INTEGER" property="conditionId" />
    <result column="SYMPTOMS_SEQ" jdbcType="INTEGER" property="symptomsSeq" />
    <result column="CONDITION_NAME" jdbcType="VARCHAR" property="conditionName" />
    <result column="CREAT_TIME" jdbcType="TIMESTAMP" property="creatTime" />
    <result column="INQUIRY_ID" jdbcType="INTEGER" property="inquiryId" />
    <result column="PER_ID" jdbcType="VARCHAR" property="perId" />
    <result column="PER_NAME_IN" jdbcType="VARCHAR" property="perNameIn" />
    <result column="CONDITION_PRICE" jdbcType="DECIMAL" property="conditionPrice" />
    <result column="PRINT_FLAG" jdbcType="INTEGER" property="printFlag" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from phy_condition_type
    where CONDITION_IDX = #{conditionIdx,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.project.dms.entiy.PhyConditionType">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="conditionIdx" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into phy_condition_type (CONDITION_TYPE, CONDITION_SUB_ID, CONDITION_ID, 
      SYMPTOMS_SEQ, CONDITION_NAME, CREAT_TIME, 
      INQUIRY_ID, PER_ID, PER_NAME_IN, 
      CONDITION_PRICE, PRINT_FLAG)
    values (#{conditionType,jdbcType=VARCHAR}, #{conditionSubId,jdbcType=INTEGER}, #{conditionId,jdbcType=INTEGER}, 
      #{symptomsSeq,jdbcType=INTEGER}, #{conditionName,jdbcType=VARCHAR}, #{creatTime,jdbcType=TIMESTAMP}, 
      #{inquiryId,jdbcType=INTEGER}, #{perId,jdbcType=VARCHAR}, #{perNameIn,jdbcType=VARCHAR}, 
      #{conditionPrice,jdbcType=DECIMAL}, #{printFlag,jdbcType=INTEGER})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.project.dms.entiy.PhyConditionType">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update phy_condition_type
    set CONDITION_TYPE = #{conditionType,jdbcType=VARCHAR},
      CONDITION_SUB_ID = #{conditionSubId,jdbcType=INTEGER},
      CONDITION_ID = #{conditionId,jdbcType=INTEGER},
      SYMPTOMS_SEQ = #{symptomsSeq,jdbcType=INTEGER},
      CONDITION_NAME = #{conditionName,jdbcType=VARCHAR},
      CREAT_TIME = #{creatTime,jdbcType=TIMESTAMP},
      INQUIRY_ID = #{inquiryId,jdbcType=INTEGER},
      PER_ID = #{perId,jdbcType=VARCHAR},
      PER_NAME_IN = #{perNameIn,jdbcType=VARCHAR},
      CONDITION_PRICE = #{conditionPrice,jdbcType=DECIMAL},
      PRINT_FLAG = #{printFlag,jdbcType=INTEGER}
    where CONDITION_IDX = #{conditionIdx,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select CONDITION_IDX, CONDITION_TYPE, CONDITION_SUB_ID, CONDITION_ID, SYMPTOMS_SEQ, 
    CONDITION_NAME, CREAT_TIME, INQUIRY_ID, PER_ID, PER_NAME_IN, CONDITION_PRICE, PRINT_FLAG
    from phy_condition_type
    where CONDITION_IDX = #{conditionIdx,jdbcType=INTEGER}
  </select>
    <select id="selectRecordByInquiryId" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    
	select   a.CONDITION_IDX,a.CONDITION_TYPE,a.CONDITION_SUB_ID,a.CONDITION_ID,
	a.SYMPTOMS_SEQ,a.CONDITION_NAME,a.INQUIRY_ID,a.PER_ID,a.CREAT_TIME,a.CONDITION_PRICE,a.PRINT_FLAG  
	
	 from   PHY_CONDITION_TYPE a  
	inner join PHY_CONDITION_LIST b on b.CONDITION_IDX=a.CONDITION_IDX 
	inner join PHY_CONDITION_DRUG c on c.CONDITION_SUB_IDX=b.CONDITION_SUB_IDX 
	where a.INQUIRY_ID=#{inquiryId,jdbcType=INTEGER} 
	group by a.CONDITION_IDX,a.CONDITION_TYPE,a.CONDITION_SUB_ID,a.CONDITION_ID,
	a.SYMPTOMS_SEQ,a.CONDITION_NAME,a.INQUIRY_ID,a.PER_ID,a.CREAT_TIME,a.CONDITION_PRICE,a.PRINT_FLAG  
	 
  </select>
  
      <select id="selectRecordDetailByConditionIdx" resultType="java.util.Map">
     	
		select aa.CONDITION_TYPE as conditionType,group_concat(d.PHY_PART order by aa.CONDITION_PART desc separator ',') as parts,
      		e.ORGANS_NAME as organsName,f.TONGUE_COLOR as tongueColor,aa.CONDITION_PRICE as amount  
		from (
		
		select  c.CONDITION_TYPE,c.CONDITION_PART,d.ORGANS_SEQ,d.TONGUE_SEQ,a.CONDITION_PRICE 
			
			 from   PHY_CONDITION_TYPE a  
			inner join PHY_CONDITION_LIST b on b.CONDITION_IDX=a.CONDITION_IDX 
			inner join PHY_CONDITION_DRUG c on c.CONDITION_SUB_IDX=b.CONDITION_SUB_IDX 
			inner join INQUIRY_RCD_SUB d on d.CONDITION_ID=a.CONDITION_ID 
		
			where a.CONDITION_IDX=#{conditionIdx,jdbcType=INTEGER} 
			GROUP BY c.CONDITION_TYPE,c.CONDITION_PART ,d.ORGANS_SEQ,d.TONGUE_SEQ,a.CONDITION_PRICE 
		
		) aa 
		inner join PHY_PART_TYPE d on aa.CONDITION_PART=d.PHY_SEQ
		inner join PHY_ORGANS_TYPE e on e.ORGANS_SEQ=aa.ORGANS_SEQ 
		inner join PHY_TONGUE_TYPE f on f.TONGUE_SEQ=aa.TONGUE_SEQ 
		GROUP BY aa.CONDITION_TYPE,e.ORGANS_NAME,f.TONGUE_COLOR,aa.CONDITION_PRICE 
	 
  </select>
  
  <select id="selectDrugDetailByConditionIdx" resultType="java.util.Map">
     	
		select  d.DRUG_NAME as name,d.UNIT_PRICE as price,sum(c.UNIT_QTY) as count 	
		 from   PHY_CONDITION_TYPE a  
		inner join PHY_CONDITION_LIST b on b.CONDITION_IDX=a.CONDITION_IDX 
		inner join PHY_CONDITION_DRUG c on c.CONDITION_SUB_IDX=b.CONDITION_SUB_IDX 
	inner join DRUG_LIST_DEF d on c.DRUG_ID=d.DRUG_ID
		where a.CONDITION_IDX=#{conditionIdx,jdbcType=INTEGER} 
	GROUP BY d.DRUG_NAME,d.UNIT_PRICE
	 
  </select>
  
  
  
  

  
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select CONDITION_IDX, CONDITION_TYPE, CONDITION_SUB_ID, CONDITION_ID, SYMPTOMS_SEQ, 
    CONDITION_NAME, CREAT_TIME, INQUIRY_ID, PER_ID, PER_NAME_IN, CONDITION_PRICE, PRINT_FLAG
    from phy_condition_type
  </select>
</mapper>